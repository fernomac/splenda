<html>
  <head>
    <title>Splenda</title>
    <link href="/assets/main.css" rel="stylesheet" type="text/css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>
      const userid = '{{USERID}}'
      const gameid = '{{GAMEID}}'

      const othercolor = {
        'red': 'white',
        'blue': 'white',
        'green': 'white',
        'black': 'white',
        'white': 'black',
      }

      var game = {}

      function renderNobles(nobles) {
        var html = '<div class="nobles">'

        for (noble of nobles) {
          html += '<div class="noble">'
          html += '<div class="info">'
          html += '<div class="points">' + noble.points + '</div>'
          html += '<div style="flex-grow: 1;"></div>'
          for (color in noble.cost) {
            html += '<div class="cost ' + color + '">'
            html += noble.cost[color]
            html += '</div>'
          }
          html += '</div></div>'
        }

        html += '</div>'
        return html
      }

      function renderCards(cards) {
        var html = '<div class="cards">'
        for (card of cards) {
          html += '<div class="card ' + card.color + 'card">'
          html += '<div class="top">'
          html += '<div class="points">' + card.points + '</div>'
          html += '<div class="gem ' + card.color + '"></div>'
          html += '</div><div class="info">'
          for (color in card.cost) {
            html += '<div class="cost ' + color + '">'
            html += card.cost[color]
            html += '</div>'
          }
          html += '</div></div>'
        }
        html += '</div>'
        return html
      }

      function renderCoins(coins) {
        var html = '<div class="coins">'
        for (color of ['green', 'white', 'blue', 'black', 'red', 'wild']) {
          html += '<div class="coin ' + color + '"><div class="num">' + coins[color] + '</div></div>'
        }
        html += '</div>'
        return html
      }

      function renderTable(table) {
        var html = renderNobles(table.nobles)
        html += '<div>'
        html += renderCards(table.cards[2])
        html += renderCards(table.cards[1])
        html += renderCards(table.cards[0])
        html += '</div>'
        html += renderCoins(table.coins)

        document.getElementById('table').innerHTML = html
      }

      function renderPlayerCards(cards) {
        var html = '<div class="cards">'
        for (color of ['green', 'white', 'blue', 'black', 'red']) {
          var count = 0
          if (cards[color]) {
            count = cards[color].length
          }
          html += '<div class="smallcard ' + color + '">'
          html += '<div class="num">' + count + '</div>'
          html += '</div>'
        }
        html += '<div style="width: 1.2em; border: 1px solid transparent;"></div>'
        html += '</div>'
        return html
      }

      function renderPlayer(player) {
        var html = '<div class="player">'
        html += '<div class="top">'
        html += '<div class="id">' + player.id + '</div>'
        html += '<div class="points">score: ' + player.points + '</div>'
        html += '</div>'
        html += renderCoins(player.coins)
        html += renderPlayerCards(player.cards)
        html += '</div>'
        return html
      }

      function renderPlayers(players) {
        var html = ""
        for (player of players) {
          html += renderPlayer(player)
        }
        document.getElementById('players').innerHTML = html
      }

      function render() {
        renderTable(game.table)
        renderPlayers(game.players)
      }

      function update() {
        fetch('/api/games/'+gameid).then(function(res) {
          return res.json()
        }).then(function(json) {
          game = json
          render()
        })
      }

      window.onload = update
    </script>
  </head>
  <body>
    <div class="root">
      <div class="top-bar">
        <span class="logo">Splenda</span>
        <span class="links"><a href="logout">logout</a></span>
      </div>
      <div class="main">
        <div class="game">
          <div id="table" class="table"></div>
          <div id="players" class="players"></div>
        </div>
      </div>
    </div>
  </body>
</html>
